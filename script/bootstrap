#!/bin/bash -eu
#
# script/bootstrap
# mas
#
# Installs development dependencies and builds project dependencies.
#

mas_dir="$(readlink -fn "$(dirname "${BASH_SOURCE:-"${0}"}")/..")"

if ! cd -- "${mas_dir}"; then
  printf $'Error: Could not cd into mas directory: %s\n' "${mas_dir}" >&2
  exit 1
fi

main() {
  script/clean

  printf $'==> ðŸ‘¢ Bootstrapping\n'

  # Install Homebrew tools
  rm -f Brewfile.lock.json
  brew bundle install --no-upgrade --verbose

  # Already installed on GitHub Actions runner.
  if [[ ! -x "$(command -v swiftlint)" ]]; then
    brew install swiftlint
  fi

  # Generate Package.swift
  script/version
}

main
