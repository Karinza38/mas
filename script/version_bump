#!/bin/bash -e
#
# script/version_bump
# mas
#
# Increments the marketing version of mas.
#

last_tag=$(script/version)
echo "Last git tag: $last_tag"

# arg 1 - version tag
if test -n "$1"; then
  # auto-increment
  MAS_VERSION=$1
else
  next_tag=$last_tag
  MAS_VERSION=$next_tag
fi

echo "MAS_VERSION: $MAS_VERSION"

# Write new version into swift package
SCRIPT_PATH=$(dirname "$(which "$0")")
PACKAGE_MANIFEST="${SCRIPT_PATH}/../Sources/MasKit/Package.swift"
cat <<EOF >"${PACKAGE_MANIFEST}"
// Generated by: script/version
enum Package {
    static let version = "${MAS_VERSION}"
}
EOF

echo
cat "${PACKAGE_MANIFEST}"

